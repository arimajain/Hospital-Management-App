{% extends "base.html" %}

{% block content %}
<div class="mb-5">
  <h2 class="fw-bold mb-1 text-dark">Admin Dashboard</h2>
  <p class="text-muted small">System overview</p>
</div>

<div class="row g-3 mb-5">
  <div class="col-md-4">
    <div class="border rounded p-3 bg-white h-100 d-flex flex-column justify-content-between">
      <h6 class="text-uppercase text-muted fw-bold small mb-2">Doctors</h6>
      <div class="fs-2 fw-bold text-dark">{{ total_doctors }}</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="border rounded p-3 bg-white h-100 d-flex flex-column justify-content-between">
      <h6 class="text-uppercase text-muted fw-bold small mb-2">Patients</h6>
      <div class="fs-2 fw-bold text-dark">{{ total_patients }}</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="border rounded p-3 bg-white h-100 d-flex flex-column justify-content-between">
      <h6 class="text-uppercase text-muted fw-bold small mb-2">Upcoming Appointments</h6>
      <div class="fs-2 fw-bold text-dark">{{ total_upcoming }}</div>
    </div>
  </div>
</div>

<h6 class="fw-bold mb-3 text-secondary text-uppercase small">Management</h6>
<div class="row g-3 mb-5">
  <div class="col-md-4">
    <a href="{{ url_for('manage_doctors') }}" class="d-block text-decoration-none bg-light border rounded p-3 text-center text-dark fw-bold">
      Doctors
      <div class="small fw-normal text-muted mt-1">Add or remove</div>
    </a>
  </div>
  <div class="col-md-4">
    <a href="{{ url_for('admin_list_patients') }}" class="d-block text-decoration-none bg-light border rounded p-3 text-center text-dark fw-bold">
      Patients
      <div class="small fw-normal text-muted mt-1">View records</div>
    </a>
  </div>
  <div class="col-md-4">
    <a href="{{ url_for('admin_departments') }}" class="d-block text-decoration-none bg-light border rounded p-3 text-center text-dark fw-bold">
      Departments
      <div class="small fw-normal text-muted mt-1">Manage specialties</div>
    </a>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h6 class="fw-bold text-secondary text-uppercase small mb-0">Upcoming Activity</h6>
    <a href="{{ url_for('admin_appointments', filter='upcoming') }}" class="text-decoration-none small">View All &rarr;</a>
</div>

<div class="border rounded overflow-hidden">
  <table class="table mb-0">
    <thead class="bg-light">
      <tr>
        <th class="ps-4 py-3 text-uppercase text-muted small fw-bold border-bottom" style="width:100px;">Appt ID</th>
        <th class="ps-4 py-3 text-uppercase text-muted small fw-bold border-bottom">Date & Time</th>
        <th class="py-3 text-uppercase text-muted small fw-bold border-bottom">Doctor</th>
        <th class="py-3 text-uppercase text-muted small fw-bold border-bottom">Patient</th>
        <th class="py-3 text-uppercase text-muted small fw-bold border-bottom">Status</th>
        <th class="py-3 text-uppercase text-muted small fw-bold border-bottom text-end pe-4">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for a in upcoming %}
        <tr>
          <td class="ps-4 py-3 align-middle fw-bold text-secondary">A{{ "%02d" | format(a.id) }}</td>
          <td class="ps-4 py-3 align-middle">
            <div class="fw-bold text-dark">{{ a.date }}</div>
            <small class="text-muted">{{ a.time }}</small>
          </td>
          <td class="align-middle">{{ a.doctor_name }}</td>
          <td class="align-middle">{{ a.patient_name }}</td>
          <td class="align-middle">
            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 px-2 py-1 rounded-pill fw-normal">Booked</span>
          </td>
          <td class="align-middle text-end pe-4">
            <form method="post" action="{{ url_for('admin_cancel_appointment', appointment_id=a.id) }}" onsubmit="return confirm('Cancel this appointment?');">
                <button class="btn btn-sm btn-outline-danger py-0 px-2" style="font-size: 0.75rem;">Cancel</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="5" class="text-center py-4 text-muted small">No upcoming bookings.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="d-flex justify-content-between align-items-center mb-3 mt-5">
    <h6 class="fw-bold text-secondary text-uppercase small mb-0">Recent Past Activity</h6>
    <a href="{{ url_for('admin_appointments', filter='past') }}" class="text-decoration-none small">View All &rarr;</a>
</div>

<div class="border rounded overflow-hidden">
  <table class="table mb-0">
    <thead class="bg-light">
      <tr>
        <th class="ps-4 py-3 text-uppercase text-muted small fw-bold border-bottom" style="width:100px;">Appt ID</th>
        <th class="ps-4 py-3 text-uppercase text-muted small fw-bold border-bottom">Date & Time</th>
        <th class="py-3 text-uppercase text-muted small fw-bold border-bottom">Doctor</th>
        <th class="py-3 text-uppercase text-muted small fw-bold border-bottom">Patient</th>
        <th class="py-3 text-uppercase text-muted small fw-bold border-bottom">Status</th>
      </tr>
    </thead>
    <tbody>
      {% for a in past %}
        <tr>
          <td class="ps-4 py-3 align-middle fw-bold text-secondary">A{{ "%02d" | format(a.id) }}</td>
          <td class="ps-4 py-3 align-middle">
            <div class="fw-bold text-dark">{{ a.date }}</div>
            <small class="text-muted">{{ a.time }}</small>
          </td>
          <td class="align-middle">{{ a.doctor_name }}</td>
          <td class="align-middle">{{ a.patient_name }}</td>
          <td class="align-middle">
            <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-2 py-1 rounded-pill fw-normal">Completed</span>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="4" class="text-center py-4 text-muted small">No recent activity.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}