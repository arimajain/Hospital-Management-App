{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold mb-0">My Availability</h2>
  <a href="{{ url_for('doctor_dashboard') }}" class="btn btn-outline-secondary btn-sm">Back</a>
</div>

<div class="card mb-5 p-4 border rounded shadow-none">
  <h5 class="fw-bold mb-3">Set Availability for Next 7 Days</h5>
  <p class="text-muted small mb-4">
    Choose your available days, set hours, and pick a slot duration. The system will generate booking slots automatically.
  </p>

  <form method="post" action="{{ url_for('doctor_availability') }}">
    <div class="row mb-4">
      <div class="col-md-4">
        <label class="form-label fw-bold small text-uppercase text-muted">Slot Duration</label>
        <select name="slot_length" class="form-select">
          <option value="5">5 min</option>
          <option value="10">10 min</option>
          <option value="15" selected>15 min</option>
          <option value="30">30 min</option>
        </select>
      </div>
    </div>

    <div class="table-responsive mb-4">
      <table class="table align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:15%">Date</th>
            <th style="width:15%">Day</th>
            <th style="width:10%" class="text-center">Active</th>
            <th style="width:30%">Start Time</th>
            <th style="width:30%">End Time</th>
          </tr>
        </thead>
        <tbody>
          {% for d in days %}
            <tr>
              <td class="fw-bold text-dark">{{ d.iso }}</td>
              <td class="text-muted">{{ d.label }}</td>
              <td class="text-center">
                <div class="form-check d-inline-block">
                  <input class="form-check-input" type="checkbox" id="enable_{{ d.iso }}" name="enable_{{ d.iso }}" {% if d.enabled %}checked{% endif %}>
                </div>
              </td>
              <td>
                <select name="start_{{ d.iso }}" class="form-select form-select-sm">
                  {% for t in time_slots %}
                    <option value="{{ t }}" {% if t==d.start_time %}selected{% endif %}>{{ t }}</option>
                  {% endfor %}
                </select>
              </td>
              <td>
                <select name="end_{{ d.iso }}" class="form-select form-select-sm">
                  {% for t in time_slots %}
                    <option value="{{ t }}" {% if t==d.end_time %}selected{% endif %}>{{ t }}</option>
                  {% endfor %}
                </select>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="text-end">
      <button class="btn btn-primary px-4">Save Availability</button>
    </div>
  </form>
</div>

<h5 class="fw-bold mb-3">Slot Summary</h5>
<div class="card border rounded overflow-hidden">
  <table class="table mb-0">
    <thead class="table-light">
      <tr>
        <th class="ps-4">Date</th>
        <th>Hours</th>
        <th>Total Slots</th>
        <th>Booked</th>
      </tr>
    </thead>
    <tbody>
      {% for d in days %}
        <tr>
          <td class="ps-4 fw-bold">{{ d.iso }}</td>
          <td class="text-muted">
            {% if d.enabled %}
              {{ d.start_time }} - {{ d.end_time }}
            {% else %}
              <span class="badge bg-light text-muted border">Unavailable</span>
            {% endif %}
          </td>
          <td>{{ slots_summary[d.iso].total if d.iso in slots_summary else 0 }}</td>
          <td>
            {% if d.iso in slots_summary and slots_summary[d.iso].booked > 0 %}
                <span class="badge bg-primary bg-opacity-10 text-primary">{{ slots_summary[d.iso].booked }}</span>
            {% else %}
                <span class="text-muted">-</span>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}