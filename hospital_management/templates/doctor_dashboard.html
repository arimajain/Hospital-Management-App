{% extends "base.html" %}

{% block content %}
<div class="mb-5">
  <h2 class="fw-bold mb-1">Hello, Dr. {{ session.get('full_name').split()[2] }}</h2>
  <div class="text-muted small">
      Doctor ID: <span class="fw-bold text-dark">D{{ "%02d" | format(doctor.id) }}</span>
  </div>
</div>

<div class="row g-3 mb-5">
  <div class="col-md-4">
    <div class="border rounded p-3 bg-white h-100 d-flex flex-column justify-content-between">
      <h6 class="text-uppercase text-muted fw-bold small mb-2">My Patients</h6>
      <div class="fs-2 fw-bold text-dark">{{ total_patients }}</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="border rounded p-3 bg-white h-100 d-flex flex-column justify-content-between">
      <h6 class="text-uppercase text-muted fw-bold small mb-2">Appointments Today</h6>
      <div class="fs-2 fw-bold text-dark">{{ today_count }}</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="border rounded p-3 bg-white h-100 d-flex flex-column justify-content-between">
      <h6 class="text-uppercase text-muted fw-bold small mb-2">Upcoming Appointments</h6>
      <div class="fs-2 fw-bold text-dark">{{ active_count }}</div>
    </div>
  </div>
</div>

<div class="mb-5">
  <a href="{{ url_for('doctor_availability') }}" class="d-block text-decoration-none bg-white border rounded p-3 d-flex justify-content-between align-items-center">
    <div>
      <h6 class="fw-bold text-dark mb-1">Manage Availability</h6>
      <div class="small text-muted">Update your visiting hours and time slots</div>
    </div>
    <div class="text-muted">&rarr;</div>
  </a>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h6 class="fw-bold text-uppercase text-secondary small mb-0">Upcoming Appointments</h6>
</div>

<div class="border rounded overflow-hidden mb-5">
  <div class="list-group list-group-flush">
    {% if active_appts %}
      {% for a in active_appts %}
        <div class="list-group-item p-3 d-flex justify-content-between align-items-center">
          <div>
            <div class="small text-muted mb-1 fw-bold">APPT ID: A{{ "%02d" | format(a.id) }}</div>
            <div class="fw-bold text-dark mb-1">{{ a.patient_name }}</div>
            <div class="small text-muted">{{ a.date }} at {{ a.time }}</div>
          </div>
          <div class="d-flex gap-2">
             <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('doctor_view_patient_history', patient_id=a.patient_id) }}">History</a>
             <a class="btn btn-sm btn-success" href="{{ url_for('doctor_complete_appointment', appointment_id=a.id) }}">Complete</a>
             <form method="post" action="{{ url_for('doctor_cancel_appointment', appointment_id=a.id) }}" onsubmit="return confirm('Cancel?');">
                <button class="btn btn-sm btn-outline-danger">âœ•</button>
             </form>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="p-4 text-center text-muted small">No active appointments.</div>
    {% endif %}
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h6 class="fw-bold text-uppercase text-secondary small mb-0">My Patients</h6>
</div>

<div class="border rounded overflow-hidden">
  <div class="list-group list-group-flush">
    {% if patients %}
      {% for p in patients %}
        <a href="{{ url_for('doctor_view_patient_history', patient_id=p.patient_id) }}" class="list-group-item list-group-item-action p-3 d-flex justify-content-between align-items-center">
          <div>
            <span class="fw-bold text-dark">{{ p.full_name }}</span>
            <span class="text-muted small ms-2">{{ p.phone or '' }}</span>
          </div>
          <small class="text-primary fw-bold">View Record &rarr;</small>
        </a>
      {% endfor %}
    {% else %}
      <div class="p-4 text-center text-muted small">No patients assigned yet.</div>
    {% endif %}
  </div>
</div>
{% endblock %}



